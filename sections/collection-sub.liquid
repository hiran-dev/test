{%- comment -%} 
  Pulling from your 'custom.sub_collection' metafield 
{%- endcomment -%}
{%- assign sub_collections = collection.metafields.custom.sub_collection.value -%}

{%- if sub_collections != blank -%}
<section class="subcollection-circles-section"
         style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px; background-color: transparent;">
  <div class="{{ section.settings.width }}">
    
    <div class="circle-nav-container">
      {% for sub in sub_collections limit: section.settings.limit %}
        <div class="circle-nav-item">
          <a href="{{ sub.url }}" class="circle-nav-link">
            
            <div class="circle-image-container">
              {%- assign image = sub.image -%}
              {%- if section.settings.select_image == 'product' or image == blank -%}
                {%- assign image = sub.products.first.featured_media.preview_image -%}
              {%- endif -%}

              {%- if image != blank -%}
                {%- comment -%} 
                  Removed height/crop from URL to let CSS handle the top alignment 
                {%- endcomment -%}
                <img src="{{ image | image_url: width: 600 }}"
                     alt="{{ sub.title }}"
                     class="circle-img"
                     loading="lazy">
              {%- else -%}
                {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            </div>

            <p class="circle-title">{{ sub.title }}</p>
          </a>
        </div>
      {% endfor %}
    </div>

  </div>
</section>

<style>
  .circle-nav-container {
    display: flex;
    justify-content: center;
    gap: 25px;
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding: 10px 0;
    scrollbar-width: none;
  }
  .circle-nav-container::-webkit-scrollbar { display: none; }

  .circle-nav-item {
    flex: 0 0 auto;
    width: 140px;
    text-align: center;
  }

  .circle-nav-link {
    text-decoration: none;
    display: block;
  }

  .circle-image-container {
    width: 110px;
    height: 110px;
    margin: 0 auto 12px;
    border-radius: 50%;
    overflow: hidden;
    border: 1px solid #e1e1e1;
    transition: all 0.3s ease;
    background: #ffffff;
    display: flex;
    align-items: center;    
    justify-content: center;
  }

  .circle-nav-item:hover .circle-image-container {
    border-color: #000;
    transform: translateY(-3px);
  }

  .circle-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    /* This ensures heads are not cut off */
    object-position: top center; 
    display: block;
  }

  .circle-title {
    margin: 0;
    font-size: 13px;
    color: #333;
    font-weight: 500;
    text-transform: capitalize;
    letter-spacing: 0.5px;
  }

  @media only screen and (max-width: 767px) {
    .circle-nav-container {
      justify-content: flex-start;
      padding-left: 15px;
      gap: 15px;
    }
    .circle-nav-item { width: 100px; }
    .circle-image-container { width: 90px; height: 90px; }
    .circle-title { font-size: 11px; }
  }
</style>
{%- endif -%}

{% schema %}
{
  "name": "Subcollections (Circles)",
  "settings": [
    {
      "type": "range",
      "id": "limit",
      "min": 1,
      "max": 12,
      "step": 1,
      "label": "Show up to",
      "default": 6
    },
    {
      "type": "select",
      "id": "select_image",
      "label": "Image source",
      "default": "collection",
      "options": [
        { "value": "collection", "label": "Collection image" },
        { "value": "product", "label": "First product" }
      ]
    },
    {
      "type": "select",
      "id": "width",
      "label": "Section width",
      "default": "wrapper",
      "options": [
        { "value": "wrapper--none", "label": "Full width" },
        { "value": "wrapper", "label": "Page width" }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding top",
      "default": 25
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding bottom",
      "default": 25
    }
  ]
}
{% endschema %}